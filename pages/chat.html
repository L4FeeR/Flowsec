<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - Flowsec</title>
    <link rel="stylesheet" href="../css/chat.css">
    <link rel="stylesheet" href="../css/file-messages.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Mobile Menu Toggle Button -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" style="display: none;">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Chat Container -->
    <div class="chat-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-shield-alt"></i>
                    <span>Flowsec</span>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn-icon" id="files-btn" title="File Manager" onclick="window.location.href='file-manager.html'">
                        <i class="fas fa-folder-open"></i>
                    </button>
                    <button class="btn-icon" id="sessions-btn" title="Session Management" onclick="window.location.href='sessions.html'">
                        <i class="fas fa-shield-alt"></i>
                    </button>
                    <button class="btn-icon" id="theme-toggle" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn-icon" id="settings-btn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- User Profile Card -->
            <div class="user-profile-card">
                <img src="https://ui-avatars.com/api/?name=User&background=4CAF50&color=fff" alt="Profile" id="user-avatar" class="user-avatar">
                <div class="user-info">
                    <h3 id="user-name">Loading...</h3>
                    <p id="user-status">Online</p>
                </div>
                <button class="btn-icon logout-btn" id="logout-btn" title="Sign Out">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>

            <!-- Search Bar -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="search-users" placeholder="Search users...">
            </div>
            
            <!-- Debug Info Bar -->
                        <!-- Debug info panel -->
            <div id="debug-panel" style="padding: 12px; background: #fff3cd; border-bottom: 2px solid #ffc107; font-size: 13px;">
                <div style="font-weight: bold; margin-bottom: 8px;">üîç Debug Info:</div>
                <div id="debug-info" style="font-family: monospace; font-size: 11px; color: #333;">
                    Loading...
                </div>
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button onclick="debugUsers()" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        üîç Full Debug
                    </button>
                    <button onclick="loadUsers()" style="padding: 6px 12px; background: #764ba2; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        üîÑ Reload Users
                    </button>
                    <button onclick="document.getElementById('debug-panel').style.display='none'" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        ‚úï Hide
                    </button>
                </div>
            </div>

            <!-- Users List -->
            <div class="users-list" id="users-list">
                <div class="list-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading users...</p>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-main">
            <!-- Chat Header -->
            <header class="chat-header">
                <div class="chat-user-info">
                    <img src="https://ui-avatars.com/api/?name=Select&background=ccc&color=666" alt="User" id="chat-avatar" class="chat-avatar">
                    <div>
                        <h2 id="chat-name">Select a user to start chatting</h2>
                        <p id="chat-status" class="status-text">‚Äî</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="btn-logout-main" id="logout-btn-main" title="Sign Out">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sign Out</span>
                    </button>
                </div>
            </header>

            <!-- Messages Area -->
            <div class="messages-area" id="messages-area">
                <div class="empty-chat">
                    <i class="fas fa-comments"></i>
                    <h3>No conversation selected</h3>
                    <p>Choose a user from the sidebar to start chatting</p>
                </div>
            </div>

            <!-- Message Input -->
            <footer class="message-input-area">
                <button class="btn-icon" id="attach-file-btn" title="Attach File">
                    <i class="fas fa-paperclip"></i>
                </button>
                <input type="file" id="file-input" style="display: none;" accept="*/*">
                <input type="text" id="message-input" placeholder="Type a message..." disabled>
                <button class="btn-icon" title="Emoji">
                    <i class="fas fa-smile"></i>
                </button>
                <button class="btn-send" id="send-btn" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </footer>
        </main>
    </div>

    <!-- Sign Out Confirmation Modal -->
    <div class="modal-overlay" id="signout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
                <h3>Sign Out?</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to sign out from Flowsec?</p>
                <div class="modal-info">
                    <i class="fas fa-shield-alt"></i>
                    <span>Your encryption keys will remain safe on this device</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal-cancel" id="cancel-signout">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button class="btn-modal-confirm" id="confirm-signout">
                    <i class="fas fa-sign-out-alt"></i>
                    Sign Out
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <h3>Settings</h3>
                <button class="btn-icon close-modal" id="close-settings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body settings-body">
                <!-- Appearance Section -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <i class="fas fa-palette"></i>
                        <h4>Appearance</h4>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <label for="theme-select">Theme</label>
                            <p>Choose your preferred theme</p>
                        </div>
                        <select id="theme-select" class="settings-select">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto (System)</option>
                        </select>
                    </div>
                </div>

                <!-- Security Section -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <i class="fas fa-shield-alt"></i>
                        <h4>Security</h4>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <label>Encryption Status</label>
                            <p id="encryption-status">End-to-end encryption enabled</p>
                        </div>
                        <button class="btn-secondary" id="regenerate-keys-settings">
                            <i class="fas fa-sync-alt"></i>
                            Regenerate Keys
                        </button>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <label>Key Fingerprint</label>
                            <p id="key-fingerprint" style="font-family: monospace; font-size: 11px;">Loading...</p>
                        </div>
                    </div>
                </div>

                <!-- About Section -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <i class="fas fa-info-circle"></i>
                        <h4>About</h4>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <label>Flowsec</label>
                            <p>Secure, encrypted messaging platform</p>
                        </div>
                        <span class="version-badge">v1.0.0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script src="../js/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="../js/supabase-client.js"></script>
    <script src="../js/session-manager.js"></script>
    <script src="../js/encryption.js"></script>
    <script src="../js/virustotal.js"></script>
    <script src="../js/file-service.js"></script>
    <script src="../js/theme-toggle.js"></script>
    <script src="../js/chat.js"></script>
</body>
</html>
```
</body>
</html>